\section{Introduction}

\subsection{Effective models}

\co{Effective models enable the study of complex physical systems by reducing the
space of interest to a low energy one.}
Effective models enable the study of complex physical systems by reducing the
dimensionality of the Hilbert space.
Their construction separates the effective subspace from the remaining Hilbert
space, such that low and high energy states are decoupled and separated by an
energy gap.
As a consequence, an effective model is sufficient to describe the low energy
properties of the original system while also being easier to handle, because
its eigenvalues and eigenvectors are approximate solutions to the complete
Hamiltonian.

\co{To find an effective Hamiltonian, we use perturbative approaches, like a SW
transformation or Lowdin perturbation theory.}
Common approaches to construct an effective Hamiltonian are the Schrieffer--Wolff
Schrieffer--Wolff transformation
\cite{Schrieffer_1966}, \cite{Bravyi_2011}
and Lowdin partitioning \cite{White_1950}.
Both methods are perturbative and, as input, they take a gapped Hamiltonian and
a perturbation, together with the subspaces to decouple.
Then, they find the unitary transformation that block-diagonalizes the
Hamiltonian for each perturbative order.
These methods are standard when working with superconducting circuits,
quantum dot physics, density functional theory, k.p models, and other
systems where the physics of interest lies in the low energy states.

\co{Even though these methods are standard, their algorithm is computationally
expensive, scaling poorly for large systems and high orders.}
Constructing an effective Hamiltonian, is however, a computationally expensive
task.
This is a consequence of the recursive equations that define the unitary
transformation, which require several matrix products per order.
For example, the exponential parametrization of the unitary
transformation in a Schrieffer--Wolff transformation requires computing
an exponentially growing number of matrix products per order.
Big systems, like those of many-body physics, bosonic Hamiltonians, and
otherwise large Hilbert spaces, are thus expensive to compute.
Similarly, high orders and combined perturbations are also costly, because they
require computing all the terms of smaller orders too.
Aside from the scaling, a Schrieffer--Wolff transformation also requires
truncating the expansion for the transformed Hamiltonian, effectively wasting
computational resources.
With the goal of making the construction of effective models more efficient,
there are several algorithms that have been proposed, either by using different
parametrizations of the unitary transformation, applying density matrix
perturbation theory, or even developing quantum algorithms for the study
of many-body systems.\todo[inline]{Rephrase this sentence. The idea is to say that
many people have tried to develop better algorithms}

\co{We develop an efficient algorithm capable of symbolic and numeric
computations and make it available in Pymablock.}
In this work, we introduce an algorithm to construct effective models
efficiently, making it possible to find effective models for systems with
thousands of degrees of freedom in a personal computer.
Our algorithm scales linearly with the perturbative order, does not require
truncating the outputs, and treats multiple perturbations independently.
We make the algorithm available via the open source package Pymablock, for
Python matrix block diagonalization of Hamiltonians, a versatile tool for
the study of numerical and symbolic models.

\co{Pymablock considers a Hamiltonian as a series of $2 \times 2$ block operators
and finds a minimal unitary transformation that separates its subspaces.}
Pymablock considers Hamiltonians as series of $2\times 2$ block operators.
The zeroth order, $H_0$ is block-diagonal, and the perturbative orders couple
blocks to each other and within themselves:
%
\begin{equation}
\mathcal{H} = \begin{pmatrix}H_0^{AA} & 0 \\ 0 & H_0^{BB}\end{pmatrix} + \mathcal{H}',
\end{equation}
%
where we use calligraphic letters to denote series in the perturbative
parameters, and $A$ and $B$ to denote the low and high energy subspaces.
To carry out the block-diagonalization procedure, Pymablock finds a minimal
unitary transformation $\mathcal{U}$ that cancels the off-diagonal block of the
Hamiltonian order by order.
The result of this procedure is a perturbative series of the transformed
block-diagonal Hamiltonian $\tilde{\mathcal{H}}$, whose low energy block
$\tilde{\mathcal{H}}^{AA}$ is the effective Hamiltonian.

\co{Pymablock offers the same solution as traditional methods.}
Similar to Lowdin perturbation theory or the Schrieffer--Wolff transformation,
Pymablock solves Sylvester's equation and ensures that the transformation
$\mathcal{U}$ is unitary order by order.
However, differently from other approaches, Pymablock uses efficient algorithms
by choosing an appropriate parametrization of the series of the unitary
transformation.
As a consequence, the computational cost of every order scales linearly with
the order, while the effective Hamiltonians are still mathematically equivalent.
